name: Clear GitHub actions cache
on:
    schedule:
        # From https://crontab.guru:
        # “At 00:00 on Monday and Thursday.”
        - cron: "0 0 * * 1,4"
    workflow_dispatch:

jobs:
    clear-github-caches:
        name: "Delete all caches"
        runs-on: ubuntu-latest
        permissions:
            actions: write
        steps:
            - run: |
                  gh cache --repo ${{ github.repository }} \
                  delete --all
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    populate-caches:
        name: "Populate caches"
        runs-on: ubuntu-latest
        needs:
            - clear-github-caches
        steps:
            - uses: actions/checkout@a5ac7e51b41094c92402da3b24376905380afc29 # v4.1.6
            - uses: ./.github/workflows/CreateMxtoolsCache.yml
